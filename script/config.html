<link
  rel="stylesheet"
  href="https://ssl.gstatic.com/docs/script/css/add-ons.css"
/>

<script>
  function closeWindow() {
    google.script.host.close();
  }

  function showMessage(error) {
    document.getElementById("error").innerHTML = error;
  }

  function showConfig(config) {
    document.getElementById("unsubscribeLabel").value = config.unsubscribeLabel;
    document.getElementById("successLabel").value = config.successLabel;
    document.getElementById("failLabel").value = config.failLabel;
  }

  function getConfigFromForm() {
    return {
      unsubscribeLabel: document.getElementById("unsubscribeLabel").value,
      successLabel: document.getElementById("successLabel").value,
      failLabel: document.getElementById("failLabel").value,
    };
  }

  function submit() {
    const newConfig = getConfigFromForm();

    if (
      !newConfig.unsubscribeLabel ||
      !newConfig.successLabel ||
      !newConfig.failLabel
    ) {
      showMessage("Please fill in all fields.");
      return false;
    }

    showMessage("Saving configuration, please wait..");
    google.script.run.withSuccessHandler(showMessage).saveConfig(params);
  }
</script>

<form onsubmit="submit()">
  <div class="form-group block">
    <label for="unsubscribeLabel" style="margin-bottom: 4px"
      >Unsubscribe Gmail Label Name:</label
    >
    <input
      type="text"
      id="unsubscribeLabel"
      name="unsubscribeLabel"
      placeholder="Unsubscribe"
      style="width: 250px"
    />
  </div>

  <div class="form-group block">
    <label for="successLabel" style="margin-bottom: 4px">
      Apply label once successfully unsubscribed:
    </label>
    <input
      type="text"
      id="successLabel"
      name="successLabel"
      placeholder="Unsubscribe Success"
      style="width: 250px"
    />
  </div>

  <div class="form-group block">
    <label for="failLabel" style="margin-bottom: 4px"
      >Apply label if unsuccessful:</label
    >
    <input
      type="text"
      id="failLabel"
      name="failLabel"
      placeholder="Unsubscribe Fail"
      style="width: 250px"
    />
  </div>

  <p>
    <input class="blue" type="submit" value="Save configuration" />
    <input
      class="green"
      type="button"
      value="Close window"
      onclick="google.script.host.close()"
    />
  </p>

  <p class="error" id="error"></p>
</form>

<script>
  google.script.run.withSuccessHandler(showConfig).getConfig();
</script>
